@model List<Pet>

@{
    Layout = "~/Views/Shared/_PetManager.cshtml";
}

<style>
    .container {
        max-width: 400rem;
        margin-left: 0px;
        padding: 0 15px;
    }

        .container h1 {
            font-size: 2rem;
            color: #00291C;
        }

        /* Change table header color */
        .container table thead {
            background-color: #687451; /* Header color */
        }

    .card-text {
        font-size: 2.5rem;
        font-weight: bold;
    }

    .card i {
        color: black;
        font-size: 2.5rem;
    }

    .card-body h5 {
        font-size: 1.5rem;
    }

    .card-text h2 {
        font-size: 1.5rem;
    }
</style>

<div class="container mt-10">
    <h1 class="text-start mb-4">Adopted Pets</h1>

    <div class="row">
        <div class="col-12">
            <table class="table table-striped text-center">
                <thead>
                    <tr>
                        <th scope="col" class="fs-4 fw-bold">Pet Image</th>
                        <th scope="col" class="fs-4 fw-bold">Pet Name</th>
                        <th scope="col" class="fs-4 fw-bold">Sex</th>
                        <th scope="col" class="fs-4 fw-bold">Pet Color</th>
                        <th scope="col" class="fs-4 fw-bold">Species</th>
                        <th scope="col" class="fs-4 fw-bold">Unadopt</th>
                        <th scope="col" class="fs-4 fw-bold">Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var pet in Model)
                    {
                        <tr>
                            <td>
                                @if (!string.IsNullOrEmpty(pet.PhotoPath))
                                {
                                    <img src="@pet.PhotoPath" class="img-thumbnail" width="50" alt="Pet">
                                }
                                else
                                {
                                    <img src="https://via.placeholder.com/50" class="img-thumbnail" alt="No Image">
                                }
                            </td>
                            <td>@pet.Name</td>
                            <td>@pet.Age</td>
                            <td>@pet.Color</td>
                            <td>@pet.Species</td>
                            <td>
                                <button class="btn btn-warning btn-sm unadopt-btn" data-id="@pet.Id">Unadopt</button>
                            </td>
                            <td>
                                <button class="btn btn-danger btn-sm delete-btn" data-id="@pet.Id">Delete</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $(".unadopt-btn").click(function () {
            var petId = $(this).data("id");

            $.ajax({
                url: "/Pets/UnadoptPet",
                type: "POST",
                data: { id: petId },
                success: function (response) {
                    if (response.success) {
                        location.reload(); // Refresh the page after successful unadopt
                    } else {
                        alert("Error: " + response.message);
                    }
                },
                error: function () {
                    alert("An error occurred while updating adoption status.");
                }
            });
        });

        $(".delete-btn").click(function () {
            var petId = $(this).data("id");

            if (confirm("Are you sure you want to delete this pet?")) {
                $.ajax({
                    url: "/Pets/DeletePet",
                    type: "POST",
                    data: { id: petId },
                    success: function (response) {
                        if (response.success) {
                            location.reload(); // Refresh the page after successful delete
                        } else {
                            alert("Error: " + response.message);
                        }
                    },
                    error: function () {
                        alert("An error occurred while deleting the pet.");
                    }
                });
            }
        });
    });
</script>
